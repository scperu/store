<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>ServiComp - Mega Ofertas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --pri1: #e63946;
    --pri2: #ff9f1c;
    --accent: #ff6a00;
    --accent2: #ffcc00;
    --bg: #f8fafc;
    --card: #fff;
    --text: #111827;
    --muted: #6b7280;
    --border: #e5e7eb;
    --shadow: 0 10px 25px rgba(0,0,0,.06);
    --shadow-sm: 0 2px 10px rgba(0,0,0,.05);
    --ok: #22c55e;
    --warn: #f59e0b;
    --danger: #ef4444;
  }
  * { box-sizing: border-box; }
  body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    background: var(--bg);
    color: var(--text);
  }
  .top-bar {
    background: linear-gradient(90deg, var(--pri1), var(--pri2));
    color: white;
    padding: 10px;
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    z-index: 2000;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    font-weight: bold;
    box-shadow: var(--shadow-sm);
  }
  .countdown {
    background: rgba(0,0,0,0.3);
    padding: 5px 10px;
    border-radius: 8px;
  }
  header {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: white;
    text-align: center;
    padding: 60px 20px 20px;
    margin-top: 8px;
  }
  header h1 { margin: 0; font-size: 1.9em; letter-spacing:.3px; }
  header p { margin: 6px 0 0; font-size: 1.05em; opacity:.95; }

  .filters {
    position: sticky;
    top: 40px;
    z-index: 1500;
    background: #ffffffcc;
    backdrop-filter: saturate(180%) blur(6px);
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
  }
  .filters .group {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .filters label { font-weight: 600; font-size: 0.93em; color: var(--muted); }
  .filters select, .filters button, .filters input[type="search"] {
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #fff;
    font: inherit;
    box-shadow: var(--shadow-sm);
  }
  .filters input[type="search"] { min-width: 280px; }
  .filters button {
    cursor: pointer;
    background: #111827;
    color: #fff;
    border: none;
    transition: transform .08s ease;
  }
  .filters button:active { transform: scale(.98); }

  /* ===== Carrusel de destacados ===== */
  #bannerWrap{ position:relative; display:none; }
  .banner-title { padding:10px 16px; color:#374151; font-weight:800; }
  .banner-carousel{
    display:flex; gap:16px; padding: 8px 16px 16px;
    overflow-x:auto; scroll-snap-type: x mandatory;
    scrollbar-width:none;
  }
  .banner-carousel::-webkit-scrollbar{ display:none; }
  .banner-carousel .card{
    min-width: 260px; flex:0 0 auto; scroll-snap-align:start;
    border:2px solid var(--pri2);
  }
  #bannerWrap::after{
    content:""; position:absolute; right:0; top:0; bottom:0; width:40px;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,.9));
    pointer-events:none;
  }

  .products {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 22px;
    padding: 20px;
  }
  .card {
    background: var(--card);
    border-radius: 14px;
    box-shadow: var(--shadow);
    overflow: hidden;
    display: flex; flex-direction: column;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
    animation: fadeIn 0.6s ease;
  }
  .card:hover { transform: translateY(-3px); box-shadow: 0 16px 30px rgba(0,0,0,.10); }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
  .card img { width: 100%; height: 200px; object-fit: contain; background: #f3f4f6; cursor: pointer; }
  .card-content { padding: 14px; flex: 1; display: flex; flex-direction: column; }
  .card-content h3 { margin: 0 0 6px; font-size: 1.03em; line-height:1.35; }
  .meta { font-size: .82em; color: var(--muted); margin-bottom: 6px; display:flex; justify-content: space-between; gap:8px; }

  .mini-code {
    background: #0f172a;
    color: #fff;
    padding: 3px 8px;
    border-radius: 999px;
    font-weight: 700;
    font-size: 0.78em;
    letter-spacing:.3px;
  }

  .price { font-size: 1.25em; color: var(--pri1); font-weight: 800; letter-spacing:.2px; }
  .old-price { color: #9ca3af; text-decoration: line-through; font-size: 0.9em; }
  .promo-msg { font-size: 0.83em; padding: 5px 8px; border-radius: 6px; margin-top: 6px; font-weight: 700; display:inline-block; }

  /* üî• √öltimos disponibles (parpadeo suave) */
  @keyframes softBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }
  .stock-red {
    background: #fdecec;
    color: #b91c1c;
    animation: softBlink 1.5s infinite;
    border-radius: 6px;
  }

  /* ‚ö†Ô∏è Disponibilidad limitada (oscila colores) */
  @keyframes limitedPulse {
    0%   { background: #fdecec; color: #b91c1c; }
    33%  { background: #fff4e5; color: #a16207; }
    66%  { background: #fffde7; color: #ca8a04; }
    100% { background: #fdecec; color: #b91c1c; }
  }
  .stock-orange { animation: limitedPulse 3s infinite ease-in-out; border-radius: 6px; }

  /* ‚ö° Alta disponibilidad con √≠cono animado */
  @keyframes flashIcon { 0%, 100% { text-shadow: 0 0 6px #FFD700; } 50% { text-shadow: 0 0 12px #FFC107; } }
  .stock-green { background: #e8f5e9; color: #166534; font-weight: bold; border-radius: 6px; padding: 6px 10px; }
  .stock-green::before { content: "‚ö° "; animation: flashIcon 2s infinite; }

  /* üü°‚Üîüî¥ Amarillo a rojo */
  @keyframes yellowToRed { 0% { background: #fff4e5; color: #a16207; } 100% { background: #fdecec; color: #b91c1c; } }
  .stock-yellow { animation: yellowToRed 2s infinite alternate; border-radius: 6px; }

  /* üü¢‚Üîüü° Verde a amarillo */
  @keyframes greenToYellow { 0% { background: #e8f5e9; color: #166534; } 100% { background: #fffde7; color: #ca8a04; } }
  .stock-limited { animation: greenToYellow 2s infinite alternate; border-radius: 6px; }

  /* üîµ‚Üîüü¢ Azul a verde */
  @keyframes blueToGreen { 0% { background: #e0f2fe; color: #075985; } 100% { background: #e8f5e9; color: #166534; } }
  .stock-blue { animation: blueToGreen 2.5s infinite alternate; border-radius: 6px; }

  .badge-recomendado {
    position: absolute;
    top: 10px;
    right: -35px;
    background: #fbbf24;
    color: #0f172a;
    padding: 5px 40px;
    font-size: 0.8em;
    font-weight: bold;
    transform: rotate(45deg);
    box-shadow: 0 2px 5px rgba(0,0,0,0.25);
    text-align: center;
  }


#btnWhatsappFixed {
  position: fixed;
  bottom: 20px;
  left: 20px;
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 54px;
  height: 54px;
  border-radius: 50%;
  background: #25d366;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  transition: transform 0.2s ease, background 0.2s ease;
}

#btnWhatsappFixed:hover {
  transform: scale(1.1);
  background: #128c7e;
}

#btnWhatsappFixed img {
  width: 28px;
  height: 28px;
}




  
.whatsapp-btn img:hover {
  transform: scale(1.15); /* efecto de zoom al pasar el mouse */
}

  @keyframes pulse { 0% { transform: scale(1);} 50% { transform: scale(1.08);} 100% { transform: scale(1);} }

  .modal { display:none; position: fixed; z-index: 10000; padding-top: 60px; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
  .modal-content { margin: auto; display: block; max-width: 90%; max-height: 80%; border-radius: 12px; box-shadow: var(--shadow); }
  .close { position: absolute; top: 25px; right: 35px; color: white; font-size: 35px; font-weight: bold; cursor: pointer; }

  .empty { text-align:center; color:var(--muted); padding: 30px 10px; }

  /* -------- Carrito UI Pro -------- */
  #cartPanel {
    position: fixed;
    top: 0; right: -420px;
    width: 380px; max-width: 92vw; height: 100%;
    background: #fff;
    box-shadow: -20px 0 40px rgba(0,0,0,.18);
    z-index: 20000;
    transition: right 0.28s ease;
    display: flex; flex-direction: column;
    border-left: 1px solid var(--border);
  }
  #cartPanel.open { right: 0; }

  #cartHeader {
    background: linear-gradient(90deg, var(--pri1), var(--pri2));
    color: #fff;
    padding: 2px 6px; font-weight: 600;
    display: flex; justify-content: space-between; align-items: center;
    letter-spacing:.3px;
  }
  #cartHeader button {
    border:none; background: transparent; color:#fff; font-size: 22px; cursor:pointer;
  }
  #cartItems { flex:1; overflow-y:auto; padding:14px 14px 6px; display:flex; flex-direction:column; gap:10px; }
  .cart-empty { color:var(--muted); text-align:center; padding:22px 8px; border:1px dashed var(--border); border-radius:12px; background:#fafafa; }
  .cart-item {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 10px;
  padding: 12px;
  border-bottom: 1px solid #e5e7eb;
}

  .cart-item .desc { font-size:.9em; line-height:1.35; }
  
.qty-control {
  display: flex;
  align-items: center;
  gap: 4px;                  /* menos espacio entre hijos */
  border: 1px solid var(--border);
  border-radius: 10px;       /* üëà m√°s sobrio, ya no pastilla */
  padding: 2px 6px;          /* üëà menos alto y ancho */
  background: #f8fafc;
  width: fit-content;        /* üëà ajusta al contenido */
  margin-top: 4px;
}

.qty-control button {
  width: 28px;
  height: 28px;              /* üëà antes 46px, ahora compacto */
  border: none;
  border-radius: 50%;        /* circulitos */
  cursor: pointer;
  background: #fff;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  font-size: 0.9em;
  font-weight: 600;
  transition: background 0.2s ease;
}

.qty-control button:hover {
  background: #e5e7eb;       /* gris suave al pasar */
}

.qty-control input {
  width: 28px;               /* üëà antes 40px */
  height: 24px;
  text-align: center;
  border: none;
  background: transparent;
  font-weight: 500;
  font-size: 0.9em;
}

  .cart-item .amount { font-weight:400; }

  .cart-item .remove { border:none; background:#fff; color:var(--danger); cursor:pointer; font-size:18px; }

   .cart-btn {
  background: #111827;  /* ‚Üê este color negro se aplica primero */
  color: #fff;
    border: none;
    padding: 8px 12px;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 8px;
    box-shadow: var(--shadow-sm);
  }

/* Espacio extra para que el contenido no quede tapado por la barra inferior */
body { 
  padding-bottom: 20px; 
}



/* ===== FOOTER CARRITO ===== */
#cartFooter {
  padding: 12px 14px 8px;  /* arriba, lados, abajo */
  border-top: 2px solid var(--border);
  background: #fff;
  display: flex;
  flex-direction: column;
  gap: 10px;               /* menos espacio entre filas */
}


#cartFooter .row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.95em;
  color: #374151;
}

#cartFooter input[type="number"],
#cartFooter input[type="text"] {
  font-size: 0.8em;   /* üëà fuente m√°s chica */
  padding: 6px 8px;   /* üëà menos alto */
  border-radius: 6px;
}


#cartFooter .total {
  font-size: 1.05em;  /* üëà m√°s chico que antes */
  font-weight: 800;
  margin-top: 2px;
}


#whatsappCheckout {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  background: linear-gradient(90deg, #25d366, #128c7e);
  color: #fff;
  padding: 14px;
  border-radius: 12px;
  text-decoration: none;
  font-weight: 800;
  font-size: 1.05em;
  box-shadow: 0 6px 18px rgba(37, 211, 102, 0.35);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
#whatsappCheckout:hover {
  transform: scale(1.03);
  box-shadow: 0 8px 22px rgba(37, 211, 102, 0.5);
}

#cartFooter .vaciar-btn {
  background: linear-gradient(90deg, #ef4444, #dc2626); /* rojo degradado */
  color: #fff;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-weight: 900;
  cursor: pointer;
  width: 100%;              /* ocupa todo el ancho */
  margin-top: 10px;         /* m√°s espacio arriba */
  text-transform: uppercase;/* MAY√öSCULAS */
  font-size: 1.05em;
  box-shadow: 0 6px 16px rgba(239,68,68,0.5);
  transition: transform 0.2s ease, background 0.2s ease;
}
#cartFooter .vaciar-btn:hover {
  background: linear-gradient(90deg, #dc2626, #b91c1c);
  transform: scale(1.03);
}

/* üëá asegura que nunca quede tapado */
#cartPanel {
  padding-bottom: 38px;
}


.action-btn {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  font-size: 0.85em;
  font-weight: 700;
  height: 42px;        /* üëà todos iguales en alto */
  border-radius: 8px;
  cursor: pointer;
  text-decoration: none;
  padding: 0;          /* üëà evita diferencias por padding */
}


.action-btn.green {
  background: linear-gradient(90deg, #25d366, #128c7e);
  color:#fff;
}
.action-btn.green:hover { background:#128c7e; }

.action-btn.red {
  background: linear-gradient(90deg, #ef4444, #dc2626);
  color:#fff;
  border:none;
}
.action-btn.red:hover { background:#b91c1c; }


#btnLimpiar {
  display: none !important;
}


#bannerWrap {
  display: none !important;
}

</style>


</head>
<body>

  <div class="top-bar">
    <span id="topBarMsg">üöÄ ¬°Bienvenido!</span>
    <div class="countdown" id="countdown">Cargando...</div>
  </div>

  <header>
    <h1>üî• Mega Ofertas ServiComp üî•</h1>
    <p>"Equipos confiables, soluciones inteligentes"</p>
  </header>

  <!-- Barra de filtros -->
  <div class="filters" id="filtersBar">
    <div class="group">
      <label for="searchInput">Buscar</label>
      <input type="search" id="searchInput" placeholder='Ej: laptop AND "HP Victus" NOT impresora (tambi√©n b√∫squeda normal)' />
    </div>
    <div class="group">
      <label for="categoriaFiltro">Categor√≠a</label>
      <select id="categoriaFiltro"><option value="">Todas</option></select>
    </div>
    <div class="group">
      <label for="marcaFiltro">Marca</label>
      <select id="marcaFiltro"><option value="">Todas</option></select>
    </div>

    <div class="group">
      <label for="ordenPrecio">Ordenar</label>
      <select id="ordenPrecio">
        <option value="asc">Precio m√°s bajo</option>
        <option value="desc">Precio m√°s alto</option>
      </select>
    </div>

<div class="group">
  <button id="btnLimpiar">Limpiar</button>
</div>


</div>


  <!-- Carrusel de destacados -->
  <section id="bannerWrap">
    <div class="banner-title">‚≠ê Destacados</div>
    <div class="banner-carousel" id="bannerCarousel"></div>
  </section>

  <div class="products" id="product-list">Cargando productos...</div>

  <!-- Carrito (mejorado con validaci√≥n y responsive) -->
<div id="cartPanel">

  <div id="cartHeader">
    <span>üõí Tu carrito</span>
    <button title="Cerrar" onclick="toggleCart()">‚úñ</button>
  </div>


  <div id="cartItems"></div>

<div id="cartFooter">
  <div class="row">
    <span>Subtotal:</span>
    <span>S/ <span id="cartSubtotal">0.00</span></span>

  </div>

  <!-- Flete y Cup√≥n en una sola l√≠nea -->
  <div class="row" style="display:flex; gap:10px; align-items:center;">
    <div style="flex:1; display:flex; align-items:center; gap:6px;">
      <span>Flete:</span>
      <input type="number" id="shippingInput" value="19" min="0" onchange="updateCart()" style="width:70px;" />
    </div>
    <div style="flex:1; display:flex; align-items:center; gap:6px;">
      <span>Cup√≥n:</span>
      <input type="text" id="couponInput" placeholder=" " oninput="updateCart()" style="flex:1;" />
    </div>
  </div>

  <div id="couponError" class="coupon-error" style="display:none;color:#ef4444;font-size:0.75em;margin-top:2px;">
    ‚ö†Ô∏è Cup√≥n no v√°lido
  </div>

  <div class="row total">
    <span>Total</span>
    <span>S/ <span id="cartTotal">0.00</span></span>
  </div>

  <!-- Botones juntos -->
  <div class="row" style="display:flex; gap:10px;">
    <a id="whatsappCheckout" href="#" target="_blank" class="action-btn green">
      <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" 
           style="width:18px;height:18px;" alt="WhatsApp">
      Enviar
    </a>
    <button onclick="resetCart()" class="action-btn red">
      üóëÔ∏è Vaciar
    </button>
  </div>
</div>




  <div id="imgModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImg" />
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    let G_PRODUCTOS = [];
    let G_FILTRO = [];
    let G_DESTACADOS = [];
    let G_CATEGORIAS = [];
    let G_BANNER = [];             // üëà NUEVO
let primeraBusqueda = true; // üëà controlamos si es la primera b√∫squeda

// üëá Utilidad debounce: retrasa ejecuci√≥n hasta que el usuario deja de tipear
function debounce(fn, delay) {
  let timer;
  return function(...args) {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(this, args), delay);
  };
}


// --- Manejo de localStorage ---
function loadCart(){
  try { 
    return JSON.parse(localStorage.getItem("CART")) || []; 
  } catch(e){ 
    return []; 
  }
}
function saveCart(){ 
  localStorage.setItem("CART", JSON.stringify(CART)); 
}

// --- Inicializar carrito con localStorage ---
let CART = loadCart();

    // ===================== CICLO DE OFERTAS (1h activa / espera aleatoria 1-10h) =====================
    const OFFER_DURATION_MS = 60 * 60 * 1000;   // 1 hora
    const WAIT_MIN_HOURS = 1;                   // espera m√≠nima (horas)
    const WAIT_MAX_HOURS = 10;                  // espera m√°xima (horas)
    const DISCOUNT_FACTOR = 0.90;               // 10% de descuento (ajustable)
    const LS_OFFER_START = "offerStart";
    const LS_NEXT_OFFER_START = "nextOfferStart";

    function nowMs(){ return Date.now(); }

    function getOfferStart(){ const v = localStorage.getItem(LS_OFFER_START); return v ? Number(v) : null; }
    function setOfferStart(ms){ localStorage.setItem(LS_OFFER_START, String(ms)); }
    function clearOfferStart(){ localStorage.removeItem(LS_OFFER_START); }

    function getNextOfferStart(){ const v = localStorage.getItem(LS_NEXT_OFFER_START); return v ? Number(v) : null; }
    function setNextOfferStart(ms){ localStorage.setItem(LS_NEXT_OFFER_START, String(ms)); }
    function clearNextOfferStart(){ localStorage.removeItem(LS_NEXT_OFFER_START); }

    function randomWaitMs(){
      const hours = Math.floor(Math.random() * (WAIT_MAX_HOURS - WAIT_MIN_HOURS + 1)) + WAIT_MIN_HOURS;
      return hours * 60 * 60 * 1000;
    }

    function isOfferActiveAt(t){
      const s = getOfferStart();
      if (!s) return false;
      return t >= s && t < (s + OFFER_DURATION_MS);
    }

    function msToOfferEnd(t){
      const s = getOfferStart();
      if (!s) return 0;
      return Math.max(0, (s + OFFER_DURATION_MS) - t);
    }

    function msToNextOffer(t){
      const n = getNextOfferStart();
      if (!n) return 0;
      return Math.max(0, n - t);
    }

    function startOffer(ts){
      const t = ts ?? nowMs();
      setOfferStart(t);
      clearNextOfferStart();
      renderizarBanner();
      renderizarProductos();
      updateOfferUI();
setBottomPhraseForState();

    }

    function scheduleNextOffer(ts){
      const t = ts ?? nowMs();
      const wait = randomWaitMs();
      setNextOfferStart(t + wait);
      clearOfferStart();
      renderizarBanner();
      renderizarProductos();
      updateOfferUI();
setBottomPhraseForState();

    }

    function initOfferCycle(){
      const t = nowMs();
      const s = getOfferStart();
      const n = getNextOfferStart();

      // Al entrar el usuario: si no existe estado previo, inicia oferta 1h y guarda offerStart
      if (!s && !n){
        startOffer(t);
      } else if (s){
        if (t >= s + OFFER_DURATION_MS){
          // Oferta vencida -> programar espera aleatoria
          scheduleNextOffer(t);
        } else {
          // Oferta a√∫n activa
          updateOfferUI();
        }
      } else if (n){
        if (t >= n){
          // Espera terminada -> iniciar nueva oferta
          startOffer(t);
        } else {
          // A√∫n en espera
          updateOfferUI();
        }
      }

      // Heartbeat cada segundo para avanzar el ciclo autom√°ticamente
      setInterval(tickOfferCycle, 1000);
    }

    function tickOfferCycle(){
      const t = nowMs();
      if (isOfferActiveAt(t)){
        // Cuando termine la hora de oferta, pasamos a espera
        if (msToOfferEnd(t) === 0){
          scheduleNextOffer(t);
        }
      } else {
        const n = getNextOfferStart();
        if (!n){
          // Estado inconsistente -> iniciar oferta
          startOffer(t);
          return;
        }
        if (t >= n){
          startOffer(t);
        }
      }
      updateOfferUI();
    }

    function formatHMS(msTotal){
      const hh = Math.floor(msTotal / 3600000);
      const mm = Math.floor((msTotal % 3600000) / 60000);
      const ss = Math.floor((msTotal % 60000) / 1000);
      return `${hh}h ${mm}m ${ss}s`;
    }

    function updateOfferUI(){
      const t = nowMs();
      const msgEl = document.getElementById('topBarMsg');
      const cdEl = document.getElementById('countdown');
      if (!msgEl || !cdEl) return;

      if (isOfferActiveAt(t)){
        msgEl.textContent = " ¬°Oferta activa!";
        cdEl.textContent = formatHMS(msToOfferEnd(t));
      } else {
        msgEl.textContent = " Pr√≥xima oferta en:";
        cdEl.textContent = formatHMS(msToNextOffer(t));
      }
    }

    // Helper centralizado para calcular precios seg√∫n estado de oferta
function getPrecios(producto){
  const base = Number(producto['PRECIO EN SOLES'] || 0);

  if (isOfferActiveAt(nowMs())) {
    // Oferta activa ‚Üí mostrar precio base directo
    return { 
      actual: Math.round(base), 
      tachado: Math.round(base * 1.18) 
    };
  } else {
    // Fuera de oferta ‚Üí base ajustado +7.2% y tachado +36% sobre base
    const ajustado = base * 1.072;
    return { 
      actual: Math.round(ajustado), 
      tachado: Math.round(base * 1.36) 
    };
  }
}

    let _bannerInterval = null;    // üëà NUEVO

    /* --------- UTIL: im√°genes --------- */
    function generarLinkImagen(codigo, conLarge = false) {
      const cod = String(codigo || '').toLowerCase();
      const sub1 = cod.substring(0, 2);
      let sub2 = cod.substring(2, 4);
      if (cod.includes('wd')) sub2 = 'dw';
      const base = 'https://imagenes.deltron.com.pe/images/productos//items';
      return conLarge
        ? `${base}/large/${sub1}/${sub2}/${cod}.jpg`
        : `${base}/${sub1}/${sub2}/${cod}.jpg`;
    }
    function generateSafeLargeUrl(codigo) {
      const cod = String(codigo || '').toLowerCase();
      const sub1 = cod.substring(0, 2);
      let sub2 = cod.substring(2, 4);
      if (cod.includes('wd')) sub2 = 'dw';
      return `https://imagenes.deltron.com.pe/images/productos//items/large/${sub1}/${sub2}/${cod}.jpg`;
    }

    /* --------- Cargas --------- */
    
    
async function cargarExcel() {
  const url = 'https://raw.githubusercontent.com/scperu/store/main/productos.xlsx';
  console.log("üîÑ Cargando Excel desde:", url);

  try {
    const res = await fetch(url);
    const data = await res.arrayBuffer();
    const workbook = XLSX.read(data, { type: 'array' });

    console.log("üìë Hojas:", workbook.SheetNames);

    // ----------------------------
    // Productos (hoja Sheet1)
    // ----------------------------
    const productos = XLSX.utils.sheet_to_json(workbook.Sheets["Sheet1"], { defval: "" });
    console.log("üì¶ Productos:", productos.length);

    // ----------------------------
    // Filtro (categor√≠as + mini c√≥digos)
    // ----------------------------
    const filtroData = XLSX.utils.sheet_to_json(workbook.Sheets["filtro"], { header: 1 });
    let filtro = [];
    for (let col = 0; col < filtroData[0].length; col++) {
      const categoria = String(filtroData[0][col] || "").trim();
      if (!categoria) continue;
      filtro.push(categoria);
      for (let row = 1; row < filtroData.length; row++) {
        const val = filtroData[row][col];
        if (val) filtro.push(String(val).trim());
      }
    }
    console.log("üìÇ Filtro cargado:", filtro.length, "items");

    // ----------------------------
    // Coti (destacados, solo mini c√≥digos, sin encabezados)
    // ----------------------------
    const cotiData = XLSX.utils.sheet_to_json(workbook.Sheets["coti"], { header: 1 });
    const coti = cotiData.slice(1).flat().map(x => String(x).trim()).filter(Boolean);
    console.log("‚≠ê Destacados cargados:", coti.length);

    return { productos, filtro, coti };

  } catch (e) {
    console.error("‚ùå Error cargando Excel:", e);
    return { productos: [], filtro: [], coti: [] };
  }
}



// üëá NUEVO: carga de mini-c√≥digos para el carrusel
    async function cargarBanner() {
      const res = await fetch('https://raw.githubusercontent.com/scperu/store/main/banner.txt');
      const txt = await res.text();
      return txt.split('\n').map(x => x.trim()).filter(Boolean);
    }

    /* --------- Modal imagen --------- */
    function mostrarModal(src) {
      const modal = document.getElementById('imgModal');
      const modalImg = document.getElementById('modalImg');
      modal.style.display = 'block';
      modalImg.src = src;
    }
    document.querySelector('.close').onclick = () => { document.getElementById('imgModal').style.display = 'none'; };
    window.onclick = (event) => { if (event.target === document.getElementById('imgModal')) document.getElementById('imgModal').style.display = 'none'; };

    /* --------- INIT --------- */
async function init() {
  const { productos, filtro, coti } = await cargarExcel();
  
  G_PRODUCTOS = productos;
  G_FILTRO = filtro;
  G_DESTACADOS = coti;
  G_CATEGORIAS = filtro.filter(x => isNaN(x));

  poblarMarcas();
  poblarCategoriasDesdeTxt();
  renderizarProductos();
  initOfferCycle();

      document.getElementById('marcaFiltro').addEventListener('change', () => { renderizarProductos(); /* opcional: renderizarBanner(); */});
      document.getElementById('categoriaFiltro').addEventListener('change', () => { renderizarProductos(); /* opcional: renderizarBanner(); */});
      document.getElementById('ordenPrecio').addEventListener('change', renderizarProductos);
      
// üëá funci√≥n con retardo (espera 300ms despu√©s de dejar de tipear)
const buscarConDelay = debounce(() => {
  if (primeraBusqueda) {
    document.getElementById('categoriaFiltro').value = ''; // fuerza "Todas"
    primeraBusqueda = false; // solo en la primera b√∫squeda
  }
  renderizarProductos();
}, 300);

document.getElementById('searchInput').addEventListener('input', buscarConDelay);


        document.getElementById('btnLimpiar').addEventListener('click', () => {
        document.getElementById('marcaFiltro').value = '';
        document.getElementById('categoriaFiltro').value = '';
        document.getElementById('ordenPrecio').value = 'asc';
        document.getElementById('searchInput').value = '';
        renderizarProductos();
        // renderizarBanner(); // si quieres que el carrusel responda a filtros, descomenta
      });


      document.getElementById('shippingInput').addEventListener('input', updateCart);
      document.getElementById('couponInput').addEventListener('input', updateCart);
    }

    /* --------- Poblar selects --------- */
    function poblarMarcas() {
      const base = G_PRODUCTOS.filter(p => G_FILTRO.includes(String(p['MINI CODIGO']).trim()));
      const marcas = Array.from(new Set(base.map(p => (p['MARCA'] || '').toString().trim()).filter(Boolean))).sort((a,b) => a.localeCompare(b));
      const sel = document.getElementById('marcaFiltro');
      sel.querySelectorAll('option:not([value=""])').forEach(o => o.remove());
      marcas.forEach(m => {
        const opt = document.createElement('option');
        opt.value = m; opt.textContent = m;
        sel.appendChild(opt);
      });
    }
    function poblarCategoriasDesdeTxt() {
  const sel = document.getElementById('categoriaFiltro');

  // Limpiar todas las opciones excepto "Todas"
  sel.querySelectorAll('option:not([value=""])').forEach(o => o.remove());

  // Agregar categor√≠as desde el filtro.txt
  G_CATEGORIAS.forEach(c => { 
    const opt = document.createElement('option'); 
    opt.value = c; 
    opt.textContent = c;   // sin iconos, limpio y pro
    sel.appendChild(opt); 
  });

  // ‚úÖ Seleccionar autom√°ticamente la primera categor√≠a del filtro.txt
  if (G_CATEGORIAS.length > 0) {
    sel.value = G_CATEGORIAS[0];
  }
}

    /* ===================== BUSCADOR BOOLEANO ===================== */
    function hasBooleanOps(q) { return /(\bAND\b|\bOR\b|\bNOT\b|\(|\)|&&|\|\||!)/i.test(q); }
    function normalizeOps(q) {
      q = q.replace(/\bY\b/gi, ' AND ').replace(/\bO\b/gi, ' OR ').replace(/\bNO\b/gi, ' NOT ');
      q = q.replace(/\&\&/g, ' AND ').replace(/\|\|/g, ' OR ').replace(/\!/g, ' NOT ');
      return q.replace(/\s+/g, ' ').trim();
    }
    function tokenizeQuery(q) {
      const s = normalizeOps(q).trim();
      const tokens = []; let i = 0;
      while (i < s.length) {
        const ch = s[i];
        if (ch === '(') { tokens.push({t:'LP'}); i++; continue; }
        if (ch === ')') { tokens.push({t:'RP'}); i++; continue; }
        if (ch === '"') {
          let j = i+1, buf = '';
          while (j < s.length && s[j] !== '"') { buf += s[j]; j++; }
          tokens.push({t:'TERM', v: buf.toLowerCase()});
          i = (j < s.length) ? j+1 : j; continue;
        }
        if (/\s/.test(ch)) { i++; continue; }
        let j = i, buf = '';
        while (j < s.length && !/[\s\(\)"]/.test(s[j])) { buf += s[j]; j++; }
        const word = buf.toUpperCase();
        if (word === 'AND' || word === 'OR' || word === 'NOT') tokens.push({t:word});
        else tokens.push({t:'TERM', v: buf.toLowerCase()});
        i = j;
      }
      const out = [];
      for (let k=0; k<tokens.length; k++) {
        const a = tokens[k]; out.push(a);
        const b = tokens[k+1]; if (!b) break;
        const aTermOrRP = (a.t==='TERM' || a.t==='RP');
        const bTermOrLPOrNOT = (b.t==='TERM' || b.t==='LP' || b.t==='NOT');
        if (aTermOrRP && bTermOrLPOrNOT) out.push({t:'AND'});
      }
      return out;
    }
    function toPostfix(tokens){
      const prec = { NOT:3, AND:2, OR:1 }; const rightAssoc = { NOT:true };
      const out=[]; const st=[];
      tokens.forEach(tok=>{
        if (tok.t==='TERM') out.push(tok);
        else if (tok.t==='NOT' || tok.t==='AND' || tok.t==='OR') {
          while (st.length){
            const top = st[st.length-1];
            if (top.t==='LP') break;
            const pTop = prec[top.t]||0, pTok = prec[tok.t]||0;
            if (pTop > pTok || (pTop===pTok && !rightAssoc[tok.t])) out.push(st.pop());
            else break;
          }
          st.push(tok);
        } else if (tok.t==='LP') st.push(tok);
        else if (tok.t==='RP') {
          while (st.length && st[st.length-1].t!=='LP') out.push(st.pop());
          if (st.length && st[st.length-1].t==='LP') st.pop();
        }
      });
      while (st.length) out.push(st.pop());
      return out;
    }
    function evalPostfix(postfix, text){
      const stack=[]; const contains=(term)=> text.includes(term);
      postfix.forEach(tok=>{
        if (tok.t==='TERM') stack.push( contains(tok.v) );
        else if (tok.t==='NOT') { const a = stack.pop()||false; stack.push(!a); }
        else if (tok.t==='AND') { const b = stack.pop()||false, a = stack.pop()||false; stack.push(a && b); }
        else if (tok.t==='OR') { const b = stack.pop()||false, a = stack.pop()||false; stack.push(a || b); }
      });
      return !!stack.pop();
    }
    function matchesQuery(query, text) {
      if (!query) return true;
      query = query.trim(); text = text.toLowerCase();
      if (!hasBooleanOps(query)) return text.includes(query.toLowerCase());
      const tokens = tokenizeQuery(query);
      const postfix = toPostfix(tokens);
      return evalPostfix(postfix, text);
    }

    /* ===================== RENDER: CARRUSEL ===================== */
    function startBannerAutoplay(){
      stopBannerAutoplay();
      _bannerInterval = setInterval(()=> {
        const carr = document.getElementById('bannerCarousel');
        if (!carr || !carr.firstElementChild) return;
        const card = carr.querySelector('.card');
        const step = (card?.offsetWidth || 260) + 16; // ancho + gap
        const atEnd = Math.ceil(carr.scrollLeft + carr.clientWidth) >= carr.scrollWidth;
        if (atEnd) {
          carr.scrollTo({ left: 0, behavior: 'smooth' });
        } else {
          carr.scrollBy({ left: step, behavior: 'smooth' });
        }
      }, 5000);
    }
    function stopBannerAutoplay(){ if (_bannerInterval){ clearInterval(_bannerInterval); _bannerInterval = null; } }

    function renderizarBanner(){
      const wrap = document.getElementById('bannerWrap');
      const carr = document.getElementById('bannerCarousel');
      carr.innerHTML = '';

const base = G_PRODUCTOS.filter(p =>
  G_FILTRO.includes(String(p['MINI CODIGO']).trim()) &&
  G_BANNER.includes(String(p['MINI CODIGO']).trim()) &&
  Number(p['STOCK'] || 0) > 0 // üëà oculta los sin stock
);

      if (!base.length){ wrap.style.display = 'none'; stopBannerAutoplay(); return; }
      wrap.style.display = '';

      base.forEach(p=>{
        const mini = String(p['MINI CODIGO'] || '').trim();
        const stock = Number(p['STOCK'] || 0);
        const precios = getPrecios(p);
        const precioActual = precios.actual;
        const precioTachado = precios.tachado;
        const thumbUrl = generarLinkImagen(p['CODIGO'], false);
        const largeUrl = generateSafeLargeUrl(p['CODIGO']);
        const marca = (p['MARCA'] || '').toString().trim();

        let stockMsg = '';
        if (stock === 0) stockMsg = '<div class="promo-msg stock-black">üò¢ AGOTADO</div>';
        else if (stock >= 1 && stock <= 3) stockMsg = '<div class="promo-msg stock-red">üõë Stock al l√≠mite: ' + stock + ' disponible(s)</div>';
        else if (stock >= 4 && stock <= 10) stockMsg = '<div class="promo-msg stock-yellow">üî• ¬°√öltimas unidades!</div>';
        else if (stock >= 11 && stock <= 19) stockMsg = '<div class="promo-msg stock-limited">‚ö†Ô∏è Disponibilidad limitada</div>';
        else if (stock >= 20) stockMsg = '<div class="promo-msg stock-blue">üåä Alta disponibilidad</div>';

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div style="position:relative;">
            <div class="badge-recomendado">üî•</div>
            <img src="${thumbUrl}" alt="${(p['DESCRIPCION'] || '').toString()}" loading="lazy" onclick="mostrarModal('${largeUrl}')">
          </div>
          <div class="card-content">
            <h3>${p['DESCRIPCION'] || ''}</h3>
            <div class="meta">
              <span>${marca || '‚Äî'}</span>
              <span class="mini-code">${mini || ''}</span>
            </div>
            ${stockMsg}
            <div style="display:flex; align-items:center; gap:10px; margin-top:6px;">
              <div class="old-price">S/ ${precioTachado.toLocaleString('es-PE')}</div>
              <div class="price">S/ ${precioActual.toLocaleString('es-PE')}</div>
            </div>
            <button class="cart-btn" 
  onclick="addToCart(
    '${mini}',
    '${(p['DESCRIPCION'] || '').toString().replace(/'/g,'')}',
    '${precioActual}',
    '${p['CODIGO']}'
  )">
  Agregar üõí
</button>

          </div>
        `;
        carr.appendChild(card);
      });

      startBannerAutoplay();
      carr.addEventListener('mouseenter', stopBannerAutoplay);
      carr.addEventListener('mouseleave', startBannerAutoplay);
      document.addEventListener('visibilitychange', ()=> {
        if (document.hidden) stopBannerAutoplay(); else startBannerAutoplay();
      });
 rotarColor();

    }

    /* ===================== RENDER: GRID ===================== */
    function renderizarProductos() {
      const lista = document.getElementById('product-list');
      lista.innerHTML = '';

      const marcaSeleccionada = document.getElementById('marcaFiltro').value;
      const categoriaSeleccionada = document.getElementById('categoriaFiltro').value;
      const ordenPrecio = document.getElementById('ordenPrecio').value;
      const searchValue = document.getElementById('searchInput').value;

      let productos = G_PRODUCTOS.filter(p => Number(p['STOCK'] || 0) > 0);


      if (marcaSeleccionada) {
        productos = productos.filter(p => String(p['MARCA'] || '').trim() === marcaSeleccionada);
      }
      if (categoriaSeleccionada) {
        const codigosCat = [];
        let found = false;
        for (let i = 0; i < G_FILTRO.length; i++) {
          if (G_FILTRO[i] === categoriaSeleccionada) { found = true; continue; }
          if (isNaN(G_FILTRO[i])) { if (found) break; }
          else if (found) { codigosCat.push(G_FILTRO[i]); }
        }
        productos = productos.filter(p => codigosCat.includes(String(p['MINI CODIGO']).trim()));
      }
      if (searchValue && searchValue.trim()) {
        productos = productos.filter(p =>
          matchesQuery(
            searchValue,
            (String(p['DESCRIPCION'] || '') + ' ' +
             String(p['DETALLES'] || '') + ' ' +
             String(p['MARCA'] || '') + ' ' +
             String(p['MINI CODIGO'] || '')
            ).toLowerCase()
          )
        );
      }

      productos.sort((a, b) => {
        const pa = Number(a['PRECIO EN SOLES'] || 0);
        const pb = Number(b['PRECIO EN SOLES'] || 0);
        return ordenPrecio === 'asc' ? pa - pb : pb - pa;
      });

      if (!productos.length) {
        lista.innerHTML = '<div class="empty">No hay productos para los filtros seleccionados.</div>';
        return;
      }

      productos.forEach(p => {
        const mini = String(p['MINI CODIGO'] || '').trim();
        const stock = Number(p['STOCK'] || 0);
        const precios = getPrecios(p);
        const precioActual = precios.actual;
        const precioTachado = precios.tachado;
        const thumbUrl = generarLinkImagen(p['CODIGO'], false);
        const largeUrl = generateSafeLargeUrl(p['CODIGO']);
        const marca = (p['MARCA'] || '').toString().trim();

        let badgeRecomendado = G_DESTACADOS.includes(mini) ? '<div class="badge-recomendado">‚≠ê</div>' : '';
        let stockMsg = '';
        if (stock === 0) {
          stockMsg = '<div class="promo-msg stock-black">üò¢ AGOTADO</div>';
        } else if (stock >= 1 && stock <= 3) {
          stockMsg = '<div class="promo-msg stock-red">üõë Stock al l√≠mite: ' + stock + ' disponible(s)</div>';
        } else if (stock >= 4 && stock <= 10) {
          stockMsg = '<div class="promo-msg stock-yellow">üî• ¬°√öltimas unidades!</div>';
        } else if (stock >= 11 && stock <= 19) {
          stockMsg = '<div class="promo-msg stock-limited">‚ö†Ô∏è Disponibilidad limitada</div>';
        } else if (stock >= 20) {
          stockMsg = '<div class="promo-msg stock-blue">üåä Alta disponibilidad</div>';
        }

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div style="position:relative;">
            ${badgeRecomendado}
            <img src="${thumbUrl}" alt="${(p['DESCRIPCION'] || '').toString()}" onclick="mostrarModal('${largeUrl}')">
          </div>
          <div class="card-content">
            <h3>${p['DESCRIPCION'] || ''}</h3>
            <div class="meta">
              <span>${marca || '‚Äî'}</span>
              <span class="mini-code">${mini || ''}</span>
            </div>
            ${stockMsg}

<p style="margin:.35rem 0;color:#374151;font-size:.92em;">
  ${p['DETALLES'] || ''}
  <!-- 
  <a href="https://www.deltron.com.pe/modulos/productos/items/postsql.php?item_number=${p['CODIGO']}"
     target="_blank"
     style="margin-left:6px;color:#1d4ed8;font-weight:600;text-decoration:none;">
     üîé
  </a>
  -->
</p>


            <div style="display:flex; align-items:center; gap:10px; margin-top:6px;">
              <div class="old-price">S/ ${precioTachado.toLocaleString('es-PE')}</div>
              <div class="price">S/ ${precioActual.toLocaleString('es-PE')}</div>
            </div>
            <button class="cart-btn" 
  onclick="addToCart(
    '${mini}',
    '${(p['DESCRIPCION'] || '').toString().replace(/'/g,'')}',
    '${precioActual}',
    '${p['CODIGO']}'
  )">
  Agregar üõí
</button>

          </div>
        `;
        lista.appendChild(card);
      });
  rotarColor();

    }

    /* ===================== CARRITO ===================== */
    function toggleCart() { document.getElementById('cartPanel').classList.toggle('open'); }
    function addToCart(miniCode, desc, price, codigo) {
  price = Number(price);
  let item = CART.find(i => i.miniCode === miniCode);

  if (item) {
    // Si ya est√° en el carrito, solo aumentamos cantidad
    item.qty++;
  } else {
    // Nuevo producto al carrito
    CART.push({
      miniCode,                       // c√≥digo corto
      codigo,                         // c√≥digo Deltron
      desc,                           // descripci√≥n
      price,                          // precio unitario
      qty: 1,                         // cantidad inicial
      img: generarLinkImagen(codigo)  // URL de la foto
    });
  }

  updateCart();

// üëâ Siempre abrir el carrito al agregar
document.getElementById('cartPanel').classList.add('open');

showToast("‚úÖ Producto agregado");

}


    function removeFromCart(miniCode) { 
  CART = CART.filter(i => i.miniCode !== miniCode); 
  updateCart(); 
}


function resetCart() {
  if (!CART.length) {
    showToast("‚ö†Ô∏è El carrito ya est√° vac√≠o");
    return;
  }

  if (confirm("¬øSeguro que quieres vaciar todo el carrito?")) {
    CART = [];              // vac√≠a la lista
    updateCart();           // refresca la vista
    showToast("üóëÔ∏è Carrito vaciado");
  }
}









function changeQty(miniCode, qty) {
  let item = CART.find(i => i.miniCode === miniCode);
  if (item) { 
    const n = Math.max(1, Number(qty) || 1); 
    item.qty = n; 
    updateCart(); 
  }
}

function incQty(miniCode) { 
  let it = CART.find(i => i.miniCode === miniCode); 
  if (it) { it.qty++; updateCart(); } 
}

function decQty(miniCode) { 
  let it = CART.find(i => i.miniCode === miniCode); 
  if (it) { it.qty = Math.max(1, it.qty - 1); updateCart(); } 
}

    function formatMoney(n){ return Number(n||0).toLocaleString('es-PE',{minimumFractionDigits:2, maximumFractionDigits:2}); }



function updateCart() {
  const itemsDiv = document.getElementById('cartItems');
  
  const subtotalSpan = document.getElementById('cartSubtotal');
  const totalSpan = document.getElementById('cartTotal');

  itemsDiv.innerHTML = '';
  if (!CART.length) { 
    itemsDiv.innerHTML = '<div class="cart-empty">Tu carrito est√° vac√≠o</div>'; 
  }

  let subtotal = 0;
  CART.forEach(item => {
    subtotal += item.price * item.qty;
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <img src="${item.img}" alt="${item.desc}"
           style="width:55px;height:55px;object-fit:contain;border-radius:8px;">
      <div style="flex:1; display:flex; flex-direction:column; gap:4px;">
        <div style="font-weight:400; font-size:.88em;">   <!-- üëà normal -->
  <span class="mini-code">${item.miniCode}</span>
  ${(item.codigo || '')} - ${item.desc}
</div>
<div class="amount" style="font-weight:400;">S/ ${formatMoney(item.price)}</div>
  <div class="qty-control">
          <button onclick="decQty('${item.miniCode}')">‚àí</button>
          <input type="number" min="1" value="${item.qty}" 
                 onchange="changeQty('${item.miniCode}', this.value)" />
          <button onclick="incQty('${item.miniCode}')">+</button>
        </div>
      </div>
      <button class="remove" onclick="removeFromCart('${item.miniCode}')">üóëÔ∏è</button>
    `;
    itemsDiv.appendChild(div);
  });

  // Totales
  
  subtotalSpan.textContent = formatMoney(subtotal);

  let shipping = Number(document.getElementById('shippingInput').value || 0);
  let coupon = (document.getElementById('couponInput').value || '').trim().toUpperCase();

  document.getElementById('couponError').style.display = "none";
  if (coupon === "SCFREE") {
    shipping = 0;
  } else if (coupon === "SCWELCOME") {
    shipping = Math.max(0, shipping - 10);
  } else if (coupon.length > 0) {
    document.getElementById('couponError').style.display = "block";
  }

  let total = subtotal + shipping;
  totalSpan.textContent = formatMoney(total);

  // WhatsApp detalle del pedido
  const waLines = CART.map(i =>
    `${i.miniCode} - ${i.codigo} - ${i.desc} x${i.qty} = S/ ${formatMoney(i.price * i.qty)}`
  ).join("\n");

  const waText = encodeURIComponent(
    "Pedido ServiComp:\n\n" + (waLines || "‚Äî") +
    `\n\nSubtotal: S/ ${formatMoney(subtotal)}\nFlete: S/ ${formatMoney(shipping)}\nTotal: S/ ${formatMoney(total)}`
  );
  document.getElementById('whatsappCheckout').href =
    `https://wa.me/51973952322?text=${waText}`;

  
  saveCart(); // guardar en localStorage
}


function showToast(msg) {
  const toast = document.createElement('div');
  toast.textContent = msg;
  toast.style.position = 'fixed';
  toast.style.bottom = '80px';
  toast.style.right = '20px';
  toast.style.background = '#111827';
  toast.style.color = '#fff';
  toast.style.padding = '10px 16px';
  toast.style.borderRadius = '10px';
  toast.style.fontWeight = '600';
  toast.style.boxShadow = '0 4px 10px rgba(0,0,0,0.25)';
  toast.style.zIndex = '99999';
  toast.style.opacity = '0';
  toast.style.transition = 'opacity 0.3s ease';

  document.body.appendChild(toast);
  setTimeout(() => { toast.style.opacity = '1'; }, 50);
  setTimeout(() => { toast.style.opacity = '0'; }, 2000);
  setTimeout(() => { toast.remove(); }, 2500);
}



// üé® Paleta de colores para rotar
const COLORES_ROTATIVOS = [
  "#e63946", // rojo intenso
  "#1d4ed8", // azul fuerte
  "#f59e0b", // amarillo c√°lido
  "#22c55e", // verde cl√°sico
  "#9333ea", // morado vibrante
  "#14b8a6", // turquesa
  "#ef4444", // rojo fuerte
  "#f97316", // naranja encendido
  "#3b82f6", // celeste brillante
  "#a855f7", // violeta
  "#0ea5e9", // cyan el√©ctrico
  "#d946ef", // fucsia moderno
  "#84cc16", // verde lima
  "#f43f5e", // rosado fuerte
  "#64748b"  // gris azulado elegante
];

let indiceColor = Math.floor(Math.random() * COLORES_ROTATIVOS.length); // aleatorio al inicio

function rotarColor() {
  const colorActual = COLORES_ROTATIVOS[indiceColor];
  let nuevoIndice;

  do {
    nuevoIndice = Math.floor(Math.random() * COLORES_ROTATIVOS.length);
  } while (nuevoIndice === indiceColor);

  const siguiente = COLORES_ROTATIVOS[nuevoIndice];

  const gradiente = `linear-gradient(90deg, ${colorActual}, ${siguiente})`;
  document.querySelector(".top-bar").style.background = gradiente;
  document.querySelector("header").style.background = gradiente;

  // üé® Fondo para los botones (incluye los que se agregan din√°micamente)
  document.querySelectorAll(".cart-btn, .filters button").forEach(btn => {
    btn.style.setProperty("background", colorActual, "important");
    btn.style.setProperty("color", "#fff", "important");
  });

  // üé® Color din√°mico para los mini-c√≥digos
  document.querySelectorAll(".mini-code").forEach(span => {
    span.style.setProperty("background", colorActual, "important");
    span.style.setProperty("color", "#fff", "important");
  });

  indiceColor = nuevoIndice;
}
// üëâ Ejecutar al cargar
rotarColor();

// ‚è≥ Cambiar cada 5 minutos (300000 ms)
setInterval(rotarColor, 300000);


const FRASES_ACTIVAS = [
  "üî• ¬°Oferta activa! Aprovecha ahora",
  "üí• Descuentos disponibles por 1 hora",
  "‚ö° Promos rel√°mpago, no te duermas",
  "üè∑Ô∏è Precios rebajados por tiempo limitado",
  "üéâ Ahorra mientras dure la oferta",
  "üöÄ Solo descuentos exclusivos",
  "üî• ¬°El momento de comprar es ahora!",
  "‚≠ê Ofertas especiales en esta hora",
  "üí£ Rebajas temporales, no las dejes pasar",
  "‚ö° 60 minutos de super descuentos"
];

const FRASES_INACTIVAS = [
  "‚è≥ Pr√≥ximas ofertas en breve",
  "üïí Prep√°rate: nuevas promos pronto",
  "üéØ Estate atento a la pr√≥xima hora feliz",
  "üîî Vuelven los descuentos en breve",
  "üìÖ La siguiente oferta est√° cerca",
  "üòé Rel√°jate, pronto volver√°n las promos",
  "‚ö° La pr√≥xima hora feliz se acerca",
  "üè∑Ô∏è M√°s descuentos en camino",
  "üí° Consejo: agrega productos al carrito y espera la oferta",
  "üõéÔ∏è Recuerda: los precios bajan otra vez pronto"
];

let _bottomTimer = null;
let _ultimaFrase = "";
const ROTACION_MS = 120000; // cada 2 minutos

function pickRandomDifferent(lista, ultima) {
  if (!lista.length) return "";
  if (lista.length === 1) return lista[0];
  let cand;
  do {
    cand = lista[Math.floor(Math.random() * lista.length)];
  } while (cand === ultima);
  return cand;
}

function setBottomPhraseForState() {
  const activo = isOfferActiveAt(nowMs());
  const lista = activo ? FRASES_ACTIVAS : FRASES_INACTIVAS;
  const msgEl = document.getElementById("bottomMsg");
  if (!msgEl) return;

  const nueva = pickRandomDifferent(lista, _ultimaFrase);

  msgEl.style.opacity = "0";
  setTimeout(() => {
    msgEl.textContent = nueva;
    msgEl.style.opacity = "1";
    _ultimaFrase = nueva;
  }, 160);
}

function startBottomRotation() {
  stopBottomRotation();
  _bottomTimer = setInterval(setBottomPhraseForState, ROTACION_MS);
}

function stopBottomRotation() {
  if (_bottomTimer) {
    clearInterval(_bottomTimer);
    _bottomTimer = null;
  }
}

document.addEventListener("DOMContentLoaded", () => {
  setBottomPhraseForState();
  startBottomRotation();
});

const FRASES_HEADER = [
  "üî• Mega Ofertas ServiComp üî•",
  "‚ö° Ofertas Exclusivas ServiComp ‚ö°",
  "üí• Descuentos ServiComp üí•",
  "üè∑Ô∏è Promos ServiComp üè∑Ô∏è",
  "üöÄ Super Ofertas ServiComp üöÄ",
  "‚≠ê Ahorra con ServiComp ‚≠ê",
  "üî• Rebajas ServiComp üî•"
];
  
let indiceHeader = -1; // para recordar la √∫ltima usada

function rotarHeader() {
  const h1 = document.querySelector("header h1"); // selecciona el t√≠tulo
  if (!h1) return;

  // elegir un √≠ndice aleatorio distinto al anterior
  let nuevo;
  do {
    nuevo = Math.floor(Math.random() * FRASES_HEADER.length);
  } while (nuevo === indiceHeader);

  indiceHeader = nuevo;

  // transici√≥n suave de opacidad
  h1.style.transition = "opacity 0.3s ease";
  h1.style.opacity = "0";
  setTimeout(() => {
    h1.textContent = FRASES_HEADER[indiceHeader];
    h1.style.opacity = "1";
  }, 300);
}

document.addEventListener("DOMContentLoaded", () => {
  rotarHeader();                 // ‚úÖ mostrar primera frase al cargar
  setInterval(rotarHeader, 300000); // ‚úÖ cambiar cada 5 min (300000 ms)
});



  init();
  </script>


<!-- Barra inferior de frases din√°micas -->
<div id="bottomBar" style="position:fixed;bottom:0;left:0;width:100%;background:#111827;color:#fff;text-align:center;padding:10px;font-weight:800;letter-spacing:.2px;z-index:900;box-shadow:0 -8px 20px rgba(0,0,0,.08)">
  <span id="bottomMsg">Cargando ofertas‚Ä¶</span>
</div>


<a id="btnWhatsappFixed" href="https://wa.me/51973952322" target="_blank">
  <img src="https://us3-cdn.inside-graph.com/custom/4-50-icons8-whatsapp-48.png" alt="WhatsApp">
</a>






</body>
</html>
