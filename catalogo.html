
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cat치logo de Productos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9fafb;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    #filtros {
      text-align: center;
      margin-bottom: 20px;
    }
    select, input[type="text"] {
      padding: 6px 12px;
      font-size: 16px;
      margin: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    thead {
      background-color: #1e40af;
      color: white;
    }
    tbody tr:nth-child(even) {
      background-color: #f1f5f9;
    }
    img {
      max-height: 100px;
      border-radius: 6px;
      cursor: pointer;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.8);
    }
    .modal-content {
      display: block;
      margin: 5% auto;
      max-width: 80%;
      text-align: center;
    }
    iframe {
      width: 100%;
      height: 500px;
      display: none;
    }
    .modal-img {
      max-width: 90%;
      max-height: 90vh;
      display: none;
      border-radius: 8px;
    }
    .close {
      position: absolute;
      top: 20px;
      right: 40px;
      font-size: 30px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
<h1>Cat치logo de Productos</h1>
<div id="filtros">
  <label><strong>Elija una categor칤a:</strong></label>
  <select id="filtro-cat" onchange="filtrarProductos()"></select>
  <label><strong>Filtrar por stock:</strong></label>
  <select id="filtro-stock" onchange="filtrarProductos()">
    <option value="todos">Mostrar todo</option>
    <option value="disponibles">Disponibles</option>
    <option value="agotados">Agotados</option>
    <option value="en_transito">En tr치nsito</option>
  </select>
  <br>
  <input type="text" id="busqueda" placeholder="游댌 Buscar..." onkeyup="filtrarProductos()">
</div>

<table>
  <thead>
    <tr>
      <th>Imagen</th>
      <th>C칩digo</th>
      <th>Descripci칩n</th>
      <th>Stock</th>
      <th>Detalles</th>
      <th>Precio</th>
    </tr>
  </thead>
  <tbody id="tabla-productos"></tbody>
</table>

<div id="modal" class="modal">
  <span class="close" onclick="cerrarModal()">&times;</span>
  <div class="modal-content">
    <iframe id="videoFrame" allowfullscreen></iframe>
    <img id="modalImg" class="modal-img" />
  </div>
</div>

<script>
const urlExcel = "https://raw.githubusercontent.com/scperu/store/main/proali.xlsx";
let productos = [];

function obtenerColor(descripcion) {
  const map = {
    "NEGRO": "#000000", "ROJO": "#FF0000", "AZUL": "#0000FF", "AMARILLO": "#FFD700"
  };
  for (const clave in map) {
    if (descripcion.toUpperCase().includes(clave)) return map[clave];
  }
  return null;
}

function cargarExcel() {
  fetch(urlExcel)
    .then(res => res.arrayBuffer())
    .then(data => {
      const wb = XLSX.read(data, { type: "array" });
      const sheet = wb.Sheets[wb.SheetNames[0]];
      productos = XLSX.utils.sheet_to_json(sheet);
      poblarCombos();
      renderizarTabla(productos);
    });
}

function poblarCombos() {
  const categorias = [...new Set(productos.map(p => p.CATEGORIA).filter(Boolean))].sort();
  const selectCat = document.getElementById("filtro-cat");
  selectCat.innerHTML = '<option value="todos">Mostrar todo</option>';
  categorias.forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    selectCat.appendChild(opt);
  });
}

function renderizarTabla(datos) {
  const cuerpo = document.getElementById("tabla-productos");
  cuerpo.innerHTML = "";
  datos.forEach(p => {
    const tr = document.createElement("tr");
    const stock = parseInt(p.STOCK) || 0;
    const stockEstado = stock > 0 ? "disponibles" :
                        /transito/i.test(p.DETALLES) ? "en_transito" : "agotados";
    const color = obtenerColor(p.DESCRIPCION || "");
    const codigo = color
      ? `<span style="background:${color};color:white;padding:2px 6px;border-radius:4px;">${p.CODIGO}</span>`
      : `<span style="color:gray;">${p.CODIGO}</span>`;
    const stockHTML = stock === 0 ? `<span style="color:red;">0</span>` : stock;
    const img = `<img src="${p.FOTO}" alt="Imagen" onclick="abrirModal('${p.VIDEO}', '${p.FOTO}')">`;
    tr.innerHTML = `
      <td>${img}</td>
      <td>${codigo}</td>
      <td>${p.DESCRIPCION}</td>
      <td>${stockHTML}</td>
      <td>${p.DETALLES}</td>
      <td>S/ ${parseInt(p.PRECIO)}</td>
    `;
    tr.dataset.cat = (p.CATEGORIA || "").toLowerCase();
    tr.dataset.stock = stockEstado;
    tr.dataset.texto = (p.CODIGO + " " + p.DESCRIPCION + " " + p.DETALLES).toLowerCase();
    cuerpo.appendChild(tr);
  });
}

function filtrarProductos() {
  const cat = document.getElementById("filtro-cat").value.toLowerCase();
  const stock = document.getElementById("filtro-stock").value.toLowerCase();
  const texto = document.getElementById("busqueda").value.toLowerCase();
  document.querySelectorAll("#tabla-productos tr").forEach(tr => {
    const matchCat = (cat === "todos" || tr.dataset.cat === cat);
    const matchStock = (stock === "todos" || tr.dataset.stock === stock);
    const matchTexto = texto === "" || tr.dataset.texto.includes(texto);
    tr.style.display = matchCat && matchStock && matchTexto ? "" : "none";
  });
}

function abrirModal(video, foto) {
  const modal = document.getElementById("modal");
  const iframe = document.getElementById("videoFrame");
  const img = document.getElementById("modalImg");
  if (video) {
    iframe.src = video;
    iframe.style.display = "block";
    img.style.display = "none";
  } else {
    iframe.style.display = "none";
    img.src = foto;
    img.style.display = "block";
  }
  modal.style.display = "block";
}

function cerrarModal() {
  document.getElementById("modal").style.display = "none";
  document.getElementById("videoFrame").src = "";
  document.getElementById("modalImg").src = "";
}

cargarExcel();
</script>
</body>
</html>
