<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ServiComp</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      text-align: center;
      margin: 0;
      background: linear-gradient(135deg, #dfe9f3, #ffffff);
      padding: 40px;
      user-select: none;
    }
    h2 { color: #222; }
    .img-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      margin-top: 30px;
    }
    .imagen {
      width: 260px;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: transform 0.2s;
      -webkit-user-drag: none;
    }
    .imagen:hover { transform: scale(1.05); }
    .modal, .auth-modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(6px);
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    .modal-content, .auth-content {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      border-radius: 14px;
      width: 360px;
      padding: 25px;
      text-align: left;
      animation: fadeIn 0.3s ease;
      position: relative;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px);} to { opacity:1; transform:translateY(0); } }
    .close { position: absolute; top: 10px; right: 15px; font-size: 20px; cursor: pointer; color: #fff; }
    .nota {
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      padding: 8px 10px;
      margin: 6px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .programa-block {
      border-bottom: 1px solid rgba(255,255,255,0.3);
      padding-bottom: 10px;
      margin-bottom: 10px;
    }
    .programa-block:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .copy-icon { cursor: pointer; color: #00c3ff; transition: 0.2s; }
    .copy-icon:hover { color: #fff; transform: scale(1.2); }
    .copiado { color: #b3ffb3; font-size: 14px; text-align: center; display: none; margin-top: 10px; color: #0f0; }
    input[type="password"], input[type="text"] {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 6px;
      margin-top: 10px;
      background: rgba(255,255,255,0.8);
      color: #333;
    }
    .btn {
      margin-top: 12px;
      padding: 8px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(135deg, #00c3ff, #0078ff);
      color: white;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }
    .btn:hover { background: linear-gradient(135deg, #0099ff, #005fcc); }
    .error { color: #ff9090; font-size: 13px; display: none; text-align: center; margin-top: 8px; }
  </style>
</head>
<body>

  <h2>ServiComp - Soluciones IT</h2>
  <div id="contenedor" class="img-container"></div>

  <!-- Modal principal -->
  <div id="modal" class="modal">
    <div class="modal-content" id="modal-content">
      <span class="close">&times;</span>
      <div id="contenidoModal"></div>
    </div>
  </div>

  <!-- Modal de autenticaci√≥n -->
  <div id="authModal" class="auth-modal">
    <div class="auth-content">
      <h3>ServiComp IT</h3>
      <p>üîê Escribe la clave por favor</p>
      <input type="password" id="authInput" placeholder="Escribe la clave...">
      <button class="btn" id="authBtn">Acceder</button>
      <p id="authError" class="error">‚ùå Clave incorrecta</p>
    </div>
  </div>

  <script>
    // üîí Bloqueo de inspecci√≥n y atajos
    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("keydown", function(e) {
      if (e.ctrlKey && (["u","U","s","S","p","P"].includes(e.key))) e.preventDefault();
      if ((e.ctrlKey && e.shiftKey && (["I","i"].includes(e.key))) || (e.ctrlKey && e.key === "j")) e.preventDefault();
      if (e.key === "F12") e.preventDefault();
    });

    const contenedor = document.getElementById('contenedor');
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('contenidoModal');
    const closeBtn = document.querySelector('.close');
    const authModal = document.getElementById('authModal');
    const authBtn = document.getElementById('authBtn');
    const authError = document.getElementById('authError');

    let data = {};
    let clavesDisponibles = [];

    const txtUrl = "https://scperu.github.io/store/notepad.txt";
    const AUTO_REFRESH_MS = 5 * 60 * 1000;
    setTimeout(() => { location.reload(); }, AUTO_REFRESH_MS);

    function ahoraClave() {
      const d = new Date();
      const hh = ("0" + d.getHours()).slice(-2);
      const mm = ("0" + d.getMinutes()).slice(-2);
      return hh + mm;
    }

    function showAuthModal() {
      authModal.style.display = "flex";
      document.getElementById('authInput').value = "";
      authError.style.display = 'none';
      setTimeout(() => document.getElementById('authInput').focus(), 200);
    }

    authBtn.addEventListener('click', verificarAuth);
    document.getElementById('authInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') verificarAuth();
    });

    function verificarAuth() {
      const v = document.getElementById('authInput').value.trim();
      const current = ahoraClave();
      if (clavesDisponibles.includes(v) || v === current) {
        authModal.style.display = "none";
        contenedor.style.display = "flex";
      } else {
        authError.style.display = 'block';
      }
    }

    fetch(txtUrl)
      .then(res => {
        if (!res.ok) throw new Error("No se pudo cargar el TXT");
        return res.text();
      })
      .then(text => parseTXT(text))
      .catch(err => {
        console.error("Error cargando notepad.txt:", err);
        modal.style.display = "flex";
        modalContent.innerHTML = `<h3>Error</h3><p>No se pudo cargar las notas.</p>`;
      });

    function parseTXT(text) {
      contenedor.style.display = "none";
      data = {};
      clavesDisponibles = [];

      const bloques = text.trim().split(/\n\s*\n/);
      const defaultClave = ahoraClave();

      bloques.forEach((b, i) => {
        const lineas = b.trim().split("\n").map(l => l.trim()).filter(Boolean);
        const titulo = lineas[0] || `Bloque${i + 1}`;
        const imagen = lineas[1] || "";
        const claveLine = lineas.find(l => l.toLowerCase().startsWith("clave:"));
        const clave = claveLine ? claveLine.split(":")[1].trim() : defaultClave;

        const programas = [];
        let programaActual = null;

        lineas.forEach((l) => {
          const lower = l.toLowerCase();
          if (lower.startsWith("programa")) {
            if (programaActual) programas.push(programaActual);
            programaActual = { nombre: l.split(":")[1]?.trim() || "Sin nombre" };
          } else if (lower.startsWith("user:")) {
            if (!programaActual) programaActual = { nombre: "Sin programa" };
            programaActual.user = l.split(":")[1]?.trim() || "";
          } else if (lower.startsWith("pin:")) {
            if (!programaActual) programaActual = { nombre: "Sin programa" };
            programaActual.pin = l.split(":")[1]?.trim() || "";
          }
        });
        if (programaActual) programas.push(programaActual);

        const id = `${titulo}_${i}`;
        data[id] = { titulo, imagen, clave, programas };

        if (clave) clavesDisponibles.push(clave);

        const img = document.createElement("img");
        img.src = imagen;
        img.className = "imagen";
        img.title = titulo;
        img.onclick = () => pedirClave(id);

        contenedor.appendChild(img);
      });

      showAuthModal();
    }

    function pedirClave(id) {
      const item = data[id];
      modal.style.display = "flex";
      modalContent.innerHTML = `
        <h3>üîê ${item.titulo}</h3>
        <p>Introduce la clave para acceder:</p>
        <input type="password" id="claveInput" placeholder="Escribe la clave...">
        <button class="btn" onclick="verificarClave('${id}')">Acceder</button>
        <p id="errorClave" class="error">‚ùå Clave incorrecta</p>
      `;
      setTimeout(() => document.getElementById('claveInput').focus(), 150);
    }

    function verificarClave(id) {
      const item = data[id];
      const claveInput = document.getElementById('claveInput').value.trim();
      const error = document.getElementById('errorClave');
      if (claveInput === item.clave || claveInput === ahoraClave()) {
        mostrarProgramas(id);
      } else {
        error.style.display = 'block';
      }
    }

    function mostrarProgramas(id) {
      const item = data[id];
      modalContent.innerHTML = `<h3>üìÑ ${item.titulo}</h3>`;

      item.programas.forEach(p => {
        const div = document.createElement("div");
        div.className = "programa-block";
        div.innerHTML = `<h4>${p.nombre}</h4>`;

        if (p.user) {
          const userEl = document.createElement("div");
          userEl.className = "nota";
          userEl.innerHTML = `<span>${p.user}</span><span class="copy-icon" onclick="copiar('${p.user}', this)">üìã</span>`;
          div.appendChild(userEl);
        }

        if (p.pin) {
          const pinEl = document.createElement("div");
          pinEl.className = "nota";
          pinEl.innerHTML = `<span>${p.pin}</span><span class="copy-icon" onclick="copiar('${p.pin}', this)">üìã</span>`;
          div.appendChild(pinEl);
        }

        modalContent.appendChild(div);
      });

      const mensaje = document.createElement("p");
      mensaje.className = "copiado";
      mensaje.id = "mensajeCopiado";
      mensaje.textContent = "‚úÖ Copiado";
      modalContent.appendChild(mensaje);
    }

    function copiar(txt, icono) {
      navigator.clipboard.writeText(txt);
      const msg = document.getElementById("mensajeCopiado");
      if (msg) msg.style.display = "block";
      icono.textContent = "‚úÖ";
      setTimeout(() => {
        if (msg) msg.style.display = "none";
        icono.textContent = "üìã";
      }, 1500);
    }

    closeBtn.onclick = () => modal.style.display = "none";
    window.onclick = e => {
      if (e.target === modal) modal.style.display = "none";
    };
  </script>
</body>
</html>
